<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Installer xhprof et xhprof gui sur Zend Server | ::franek::</title><meta name=keywords content="développement web,php,profiling,xdebug,xhprof,Zend Server"><meta name=description content="Xhprof est un profiler de code PHP. C&rsquo;est un concurrent de Xdebug développé par Facebook.
Il a le gros avantage de permettre de visualiser l&rsquo;évolution de la mémoire. A ma connaissance, Xdebug ne le permet pas.
Il ne nécessite pas l&rsquo;utilisation d&rsquo;un logiciel tiers (type KCachegrind, non disponible sous Windows&mldr;argh&mldr;) et peut être installé sur un serveur de production sans, normalement, trop dégrader les performances.
Je vais ici vous décrire son installation sur Zend Server CE et l&rsquo;installation de xhprof gui"><meta name=author content="franek"><link rel=canonical href=https://franek.chicour.net/post/installer-xhprof-et-xhprof-gui-sur-zend-server/><meta name=google-site-verification content="XYZabc"><link href=https://franek.chicour.net/assets/css/stylesheet.min.b6e4fb9d9486ee9750cbbe1b4e388ff4332a2d1e0d17ab3592ecb6c6f7ba1157.css integrity="sha256-tuT7nZSG7pdQy74bTjiP9DMqLR4NF6s1kuy2xve6EVc=" rel="preload stylesheet" as=style><link rel=icon href=https://franek.chicour.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://franek.chicour.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://franek.chicour.net/favicon-32x32.png><link rel=apple-touch-icon href=https://franek.chicour.net/apple-touch-icon.png><link rel=mask-icon href=https://franek.chicour.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.74.3"><meta property="og:title" content="Installer xhprof et xhprof gui sur Zend Server"><meta property="og:description" content="Xhprof est un profiler de code PHP. C&rsquo;est un concurrent de Xdebug développé par Facebook.
Il a le gros avantage de permettre de visualiser l&rsquo;évolution de la mémoire. A ma connaissance, Xdebug ne le permet pas.
Il ne nécessite pas l&rsquo;utilisation d&rsquo;un logiciel tiers (type KCachegrind, non disponible sous Windows&mldr;argh&mldr;) et peut être installé sur un serveur de production sans, normalement, trop dégrader les performances.
Je vais ici vous décrire son installation sur Zend Server CE et l&rsquo;installation de xhprof gui"><meta property="og:type" content="article"><meta property="og:url" content="https://franek.chicour.net/post/installer-xhprof-et-xhprof-gui-sur-zend-server/"><meta property="og:image" content="https://franek.chicour.net/60"><meta property="article:published_time" content="2011-04-15T11:58:00+02:00"><meta property="article:modified_time" content="2012-11-27T21:13:27+01:00"><meta property="og:site_name" content="::franek::"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://franek.chicour.net/60"><meta name=twitter:title content="Installer xhprof et xhprof gui sur Zend Server"><meta name=twitter:description content="Xhprof est un profiler de code PHP. C&rsquo;est un concurrent de Xdebug développé par Facebook.
Il a le gros avantage de permettre de visualiser l&rsquo;évolution de la mémoire. A ma connaissance, Xdebug ne le permet pas.
Il ne nécessite pas l&rsquo;utilisation d&rsquo;un logiciel tiers (type KCachegrind, non disponible sous Windows&mldr;argh&mldr;) et peut être installé sur un serveur de production sans, normalement, trop dégrader les performances.
Je vais ici vous décrire son installation sur Zend Server CE et l&rsquo;installation de xhprof gui"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Installer xhprof et xhprof gui sur Zend Server","name":"Installer xhprof et xhprof gui sur Zend Server","description":"Xhprof est un profiler de code PHP. C\u0026amp;rsquo;est un concurrent de Xdebug développé par Facebook.\nIl a le gros avantage de permettre de visualiser l\u0026amp;rsquo;évolution de la mémoire. A …","keywords":["développement web","php","profiling","xdebug","xhprof","Zend Server"],"articleBody":"Xhprof est un profiler de code PHP. C’est un concurrent de Xdebug développé par Facebook.\nIl a le gros avantage de permettre de visualiser l’évolution de la mémoire. A ma connaissance, Xdebug ne le permet pas.\nIl ne nécessite pas l’utilisation d’un logiciel tiers (type KCachegrind, non disponible sous Windows…argh…) et peut être installé sur un serveur de production sans, normalement, trop dégrader les performances.\nJe vais ici vous décrire son installation sur Zend Server CE et l’installation de xhprof gui\nSi vous utilisez une installation de PHP moins exotique (genre une debian avec les dotdeb), son installation sera, à mon avis, simplifiée :\n apt-get install php5-xhprof Installation de xhprof On récupère les sources et on les décompresse :\n $ wget http://pecl.php.net/get/xhprof-0.9.2.tgz $ tar xvfz xhprof-0.9.2.tgz On compile :\n $ cd xhprof-0.9.2/extension $ /usr/local/zend/bin/phpize $ ./configure --with-php-config=/usr/local/zend/bin/php-config $ make $ make test $ sudo make install On modifie la configuration de PHP pour lui indiquer de charger cette extension :\n $ sudo vi /usr/local/zend/etc/php.ini On ajoute :\n [xhprof] extension=xhprof.so ; ; directory used by default implementation of the iXHProfRuns ; interface (namely, the XHProfRuns_Default class) for storing ; XHProf runs. ; xhprof.output_dir=/tmp/xhprof Il est nécessaire de créer le répertoire /tmp/xhprof et de donner les droits à l’utilisateur Apache (je fais un 777 par simplicité)\n $ mkdir -p /tmp/xhprof $ chmod 777 /tmp/xhprof On redémarre Apache :\n $ sudo /etc/init.d/zend-server restart-apache Un phpinfo() doit normalement afficher l’extension xhprof.\nOn va tester rapidement que cela fonctionne en essayant de profiler un script PHP. Pour profiler il est nécessaire d’ajouter quelques lignes de code dans le script PHP. Vous verrez ensuite une technique pour l’ajouter de manière automatique sur l’ensemble des scripts PHP (via xhprof gui) :\n save_run($xhprof_data, \"xr\"); L’exécution de ce script devrait générer un fichier dans le répertoire /tmp/xhprof. Si oui, l’installation de l’extension xhprof est ok.\nVisualiser l’analyse de vos scripts xhprof propose une interface de consultation des “profiling” effectués. Cette application (xhprof gui) est disponible dans un dépôt git.\nActuellement, elle possède quelques dysfonctionnements (plantage lors de l’analyse d’un script trop important) mais qui peuvent être résolus.\nPour installer xhprof gui, vous pouvez suivre la procédure d’installation :\n git clone https://github.com/preinheimer/xhprof.git cd xhprof ln -s xhprof_lib/utils/xhprof_runs_mysql.php xhprof_runs.php mv xhprof_lib/config.sample.php xhprof_lib/config.php Xhprof gui propose de stocker les éléments d’analyse dans une base (mysql, mssql, …). Dans notre exemple, nous allons utiliser mysql.\nOn crée une base pour xhprof :\n $ mysql -uroot -p mysql  create database xhprof; xhprof gui a besoin d’une table details dans la base xhprof. La description de la table est décrite dans le fichier Mysqli.\n CREATE TABLE `details` ( `id` char(17) NOT NULL, `url` varchar(255) default NULL, `c_url` varchar(255) default NULL, `timestamp` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP, `server name` varchar(64) default NULL, `perfdata` MEDIUMBLOB, `type` tinyint(4) default NULL, `cookie` BLOB, `post` BLOB, `get` BLOB, `pmu` int(11) unsigned default NULL, `wt` int(11) unsigned default NULL, `cpu` int(11) unsigned default NULL, `server_id` char(3) NOT NULL default 't11', `aggregateCalls_include` varchar(255) DEFAULT NULL, PRIMARY KEY (`id`), KEY `url` (`url`), KEY `c_url` (`c_url`), KEY `cpu` (`cpu`), KEY `wt` (`wt`), KEY `pmu` (`pmu`), KEY `timestamp` (`timestamp`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; Il est ensuite nécessaire de créer un Virtual Host pour accéder à xhprof gui :\n DocumentRoot /mon/super/chemin/vers/xhprofgui/xhprof_html ServerName xhprof.local DirectoryIndex index.php  N’oubliez pas de l’activer et d’ajouter dans votre fichier /etc/hosts une entrée pour ce nouveau domaine.\nIl est nécessaire de modifier le fichier xhprof_lib/config.php avec les paramètres qui vont bien.\nVoici les premières lignes du fichier config.php que j’utilise :\n Ensuite pour tous les virtual hosts que vous souhaiteraient monitorer, vous pouvez ajouter les lignes suivantes dans la configuration du VH :\n php_admin_value auto_prepend_file \"/mon/super/chemin/vers/xhprofgui/external/header.php\" Désormais en bas de chaque page, vous disposerez normalement d’un lien permettant d’accéder au profiling de la page courante.\nDernier point, si vous souhaitez générer des graphiques de ce type , il est nécessaire d’installer graphviz :\n $ sudo apt-get install graphviz J’espère que ces quelques notes vous aiderons à débuter avec xhprof.\nCet article s’est largement inspiré de profiling php application?\nEdit 27/11/2012 : Correction suite à commentaire d’un visiteur.\n","wordCount":"826","inLanguage":"en","datePublished":"2011-04-15T11:58:00+02:00","dateModified":"2012-11-27T21:13:27+01:00","author":{"@type":"Person","name":"franek"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://franek.chicour.net/post/installer-xhprof-et-xhprof-gui-sur-zend-server/"},"publisher":{"@type":"Organization","name":"::franek::","logo":{"@type":"ImageObject","url":"https://franek.chicour.net/favicon.ico"}}}</script></head><body id=top><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://franek.chicour.net accesskey=h title="::franek:: (Alt + H)"><img src=/public/logo-franek.png alt=logo aria-label=logo height=35>::franek::</a>
<span class=logo-switches></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://franek.chicour.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://franek.chicour.net/archive/ title=Archives><span>Archives</span></a></li><li><a href=https://franek.chicour.net/search/ title="Recherche (Alt + /)" accesskey=/><span>Recherche</span></a></li><li><a href=https://franek.chicour.net/feed/rss2 title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Installer xhprof et xhprof gui sur Zend Server</h1><div class=post-meta>April 15, 2011&nbsp;·&nbsp;franek</div></header><div class=post-content><p><a href=http://mirror.facebook.net/facebook/xhprof/doc.html title=xhprof>Xhprof</a> est un profiler de code PHP. C&rsquo;est un concurrent de Xdebug développé par Facebook.</p><p>Il a le gros avantage de permettre de visualiser l&rsquo;évolution de la mémoire. A ma connaissance, Xdebug ne le permet pas.</p><p>Il ne nécessite pas l&rsquo;utilisation d&rsquo;un logiciel tiers (type KCachegrind, non disponible sous Windows&mldr;argh&mldr;) et peut être installé sur un serveur de production sans, normalement, trop dégrader les performances.</p><p>Je vais ici vous décrire son installation sur Zend Server CE et l&rsquo;installation de <em>xhprof gui</em></p><p>Si vous utilisez une installation de PHP moins exotique (genre une debian avec les <a href=http://www.dotdeb.org/ title=dotdeb>dotdeb</a>), son installation sera, à mon avis, simplifiée :</p><pre><code>
apt-get install php5-xhprof
</code></pre><h2 id=installation-de-xhprof>Installation de xhprof<a hidden class=anchor aria-hidden=true href=#installation-de-xhprof>#</a></h2><p>On récupère les sources et on les décompresse :</p><pre><code>
$ wget http://pecl.php.net/get/xhprof-0.9.2.tgz
$ tar xvfz xhprof-0.9.2.tgz
</code></pre><p>On compile :</p><pre><code>
$ cd xhprof-0.9.2/extension
$ /usr/local/zend/bin/phpize
$ ./configure --with-php-config=/usr/local/zend/bin/php-config
$ make
$ make test
$ sudo make install
</code></pre><p>On modifie la configuration de PHP pour lui indiquer de charger cette extension :</p><pre><code>
$ sudo vi /usr/local/zend/etc/php.ini
</code></pre><p>On ajoute :</p><pre><code>
[xhprof]
extension=xhprof.so
;
; directory used by default implementation of the iXHProfRuns
; interface (namely, the XHProfRuns_Default class) for storing
; XHProf runs.
;
xhprof.output_dir=/tmp/xhprof
</code></pre><p>Il est nécessaire de créer le répertoire /tmp/xhprof et de donner les droits à l&rsquo;utilisateur Apache (je fais un 777 par simplicité)</p><pre><code>
$ mkdir -p /tmp/xhprof
$ chmod 777 /tmp/xhprof
</code></pre><p>On redémarre Apache :</p><pre><code>
$ sudo /etc/init.d/zend-server restart-apache
</code></pre><p>Un phpinfo() doit normalement afficher l&rsquo;extension xhprof.</p><p>On va tester rapidement que cela fonctionne en essayant de profiler un script PHP. Pour profiler il est nécessaire d&rsquo;ajouter quelques lignes de code dans le script PHP. Vous verrez ensuite une technique pour l&rsquo;ajouter de manière automatique sur l&rsquo;ensemble des scripts PHP (via xhprof gui) :</p><pre><code>
&lt;?php
...
xhprof_enable();

/**
 * your application code
 * ......
 * ......
 */

$xhprof_data = xhprof_disable();
$xhprof_root = '/chemin/vers/le/repertoire/xhprof-0.9.2/';
include_once $xhprof_root . &quot;xhprof_lib/utils/xhprof_lib.php&quot;;
include_once $xhprof_root . &quot;xhprof_lib/utils/xhprof_runs.php&quot;;
$xhprof_runs = new XHProfRuns_Default();
$run_id = $xhprof_runs-&gt;save_run($xhprof_data, &quot;xr&quot;);
</code></pre><p>L&rsquo;exécution de ce script devrait générer un fichier dans le répertoire /tmp/xhprof. Si oui, l&rsquo;installation de l&rsquo;extension xhprof est ok.</p><h2 id=visualiser-lanalyse-de-vos-scripts>Visualiser l&rsquo;analyse de vos scripts<a hidden class=anchor aria-hidden=true href=#visualiser-lanalyse-de-vos-scripts>#</a></h2><p>xhprof propose une interface de consultation des &ldquo;profiling&rdquo; effectués. Cette application (xhprof gui) est disponible dans un <a href=https://github.com/preinheimer/xhprof title="xhprof gui">dépôt git</a>.</p><p><img src=https://franek.chicour.net/public/xhprof/.XHGuiRun_m.jpg alt="Xhprof gui" title="Xhprof gui, avr. 2011"></p><p>Actuellement, elle possède quelques dysfonctionnements (plantage lors de l&rsquo;analyse d&rsquo;un script trop important) mais qui peuvent être résolus.</p><p>Pour installer <em>xhprof gui</em>, vous pouvez suivre la procédure d&rsquo;installation :</p><pre><code>
git clone https://github.com/preinheimer/xhprof.git
cd xhprof
ln -s xhprof_lib/utils/xhprof_runs_mysql.php xhprof_runs.php
mv xhprof_lib/config.sample.php xhprof_lib/config.php
</code></pre><p><em>Xhprof gui</em> propose de stocker les éléments d&rsquo;analyse dans une base (mysql, mssql, &mldr;). Dans notre exemple, nous allons utiliser mysql.</p><p>On crée une base pour xhprof :</p><pre><code>
$ mysql -uroot -p
mysql &gt; create database xhprof;
</code></pre><p><em>xhprof gui</em> a besoin d&rsquo;une table <em>details</em> dans la base xhprof. La description de la table est décrite dans le fichier <a href=https://github.com/preinheimer/xhprof/blob/master/xhprof_lib/utils/Db/Mysqli.php>Mysqli</a>.</p><pre><code>
 CREATE TABLE `details` (
`id` char(17) NOT NULL,
`url` varchar(255) default NULL,
`c_url` varchar(255) default NULL,
`timestamp` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
`server name` varchar(64) default NULL,
`perfdata` MEDIUMBLOB,
`type` tinyint(4) default NULL,
`cookie` BLOB,
`post` BLOB,
`get` BLOB,
`pmu` int(11) unsigned default NULL,
`wt` int(11) unsigned default NULL,
`cpu` int(11) unsigned default NULL,
`server_id` char(3) NOT NULL default 't11',
`aggregateCalls_include` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `url` (`url`),
KEY `c_url` (`c_url`),
KEY `cpu` (`cpu`),
KEY `wt` (`wt`),
KEY `pmu` (`pmu`),
KEY `timestamp` (`timestamp`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
</code></pre><p>Il est ensuite nécessaire de créer un Virtual Host pour accéder à <em>xhprof gui</em> :</p><pre><code>
&lt;VirtualHost *:80&gt;
   DocumentRoot /mon/super/chemin/vers/xhprofgui/xhprof_html
   ServerName xhprof.local
   DirectoryIndex index.php
&lt;/VirtualHost&gt;
</code></pre><p>N&rsquo;oubliez pas de l&rsquo;activer et d&rsquo;ajouter dans votre fichier /etc/hosts une entrée pour ce nouveau domaine.</p><p>Il est nécessaire de modifier le fichier xhprof_lib/config.php avec les paramètres qui vont bien.</p><p>Voici les premières lignes du fichier config.php que j&rsquo;utilise :</p><pre><code>
&lt;?php
$_xhprof = array();

// Change these:
$_xhprof['dbhost'] = 'localhost';
$_xhprof['dbuser'] = 'root';
$_xhprof['dbpass'] = 'root';
$_xhprof['dbname'] = 'xhprof';
$_xhprof['servername'] = 'myserver';
$_xhprof['namespace'] = 'myapp';
$_xhprof['url'] = 'http://xhprof.local/';

//These are good for linux and its derivatives.
//*
$_xhprof['dot_binary']  = '/usr/bin/dot';
$_xhprof['dot_tempdir'] = '/tmp';
$_xhprof['dot_errfile'] = '/tmp/xh_dot.err';
//*/

$exceptionURLs = array();

$exceptionPostURLs = array();
$exceptionPostURLs[] = &quot;login&quot;;


$_xhprof['display'] = false;
$_xhprof['doprofile'] = true;

$controlIPs = array();
$controlIPs[] = &quot;127.0.0.1&quot;;   //Localhost, you'll want to add your own ip here
$controlIPs[] = &quot;ma super ip personnelle&quot;;   // Je bosse sous Windows (on ne choisit pas toujours...) mais mon serveur est dans une VM. J'indique l'IP de mon Windows.

$otherURLS = array();

$weight = 100;
</code></pre><p>Ensuite pour tous les virtual hosts que vous souhaiteraient monitorer, vous pouvez ajouter les lignes suivantes dans la configuration du VH :</p><pre><code>
php_admin_value auto_prepend_file &quot;/mon/super/chemin/vers/xhprofgui/external/header.php&quot;
</code></pre><p>Désormais en bas de chaque page, vous disposerez normalement d&rsquo;un lien permettant d&rsquo;accéder au profiling de la page courante.</p><p>Dernier point, si vous souhaitez générer des graphiques de ce type <img src=https://franek.chicour.net/public/xhprof/.XHGuiCallGraph_m.jpg alt="xhprof gui callgraph" title="xhprof gui callgraph, avr. 2011">, il est nécessaire d&rsquo;installer graphviz :</p><pre><code>
$ sudo apt-get install graphviz
</code></pre><p>J&rsquo;espère que ces quelques notes vous aiderons à débuter avec xhprof.</p><p>Cet article s&rsquo;est largement inspiré de <a href=http://css.dzone.com/news/profiling-php-application title="Profiling php application">profiling php application</a>?</p><p>Edit 27/11/2012 : Correction suite à commentaire d&rsquo;un visiteur.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://franek.chicour.net/tags/d%C3%A9veloppement-web/>développement web</a></li><li><a href=https://franek.chicour.net/tags/php/>php</a></li><li><a href=https://franek.chicour.net/tags/profiling/>profiling</a></li><li><a href=https://franek.chicour.net/tags/xdebug/>xdebug</a></li><li><a href=https://franek.chicour.net/tags/xhprof/>xhprof</a></li><li><a href=https://franek.chicour.net/tags/zend-server/>Zend Server</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://franek.chicour.net>::franek::</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=https://franek.chicour.net/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script></body></html>